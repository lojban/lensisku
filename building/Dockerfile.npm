# Pin version for reproducible, cache-friendly builds
FROM node:24-alpine

ARG USERNAME
ARG UID
ARG GID

# Prevent Corepack from prompting to download pnpm (e.g. in CI/deploy)
ENV COREPACK_ENABLE_DOWNLOAD_PROMPT=0

RUN apk add --no-cache bash && corepack enable && corepack prepare pnpm@9 --activate

RUN mkdir -p /home/$USERNAME/.local/share/pnpm /home/$USERNAME/.npm \
    && chown -R $UID:$GID /home/$USERNAME

ENV HOME=/home/$USERNAME
ENV PNPM_HOME=/home/$USERNAME/.local/share/pnpm
ENV PATH="$PNPM_HOME:$PATH"
